% This is the preamble
% <https://en.wikibooks.org/wiki/LaTeX/Document_Structure#Global_structure> of
% Bylaws.tex. If you want to change the text of the bylaws, edit Bylaws.tex. If
% you want to change the formatting of the bylaws, edit this file.

\input ushyphex
\usepackage[no-config]{fontspec}
\usepackage[hmargin=1.8in,marginparwidth=1in]{geometry}
% See
% https://tex.stackexchange.com/questions/24445/hyperref-lualatex-and-unicode-bookmarks-issue-garbled-page-numbers-in-ar-for-l
% for why pdfencoding=auto is needed.
\usepackage[hidelinks,pdfencoding=auto]{hyperref}
\usepackage{marginnote}
\usepackage{ragged2e}
\usepackage{titlesec}

% Use Libertinus <https://github.com/libertinus-fonts/libertinus>, a free and
% open-source font.
\setmainfont{Libertinus Serif}[Numbers={OldStyle,Proportional}]

% Change the category code (catcode) of @ to permit using and modifying internal
% LaTeX commands.
\makeatletter

% Don’t indent paragraphs.
\parindent\z@
% Separate paragraphs by 6 pt (“bp” means “big point”, and 1bp is 1/72 inch),
% plus or minus 2 pt.
\parskip=6bp plus 2bp minus 2bp

% From Section 7.1 of “Standard Document Classes for LaTeX version 2e”
% <https://ctan.org/pkg/article>, the \@maketitle macro produces a title when
% the title isn’t on a separate page. Redefine \@maketitle to reduce vertical
% spacing and omit the author.
\def\@maketitle{%
  \newpage
  \begin{center}%
    {\LARGE \@title \par}%
    \vskip 1em%
    {\large \@date}%
  \end{center}%
  \par
  \vskip 1.5em}

% Redefine the \tableofcontents command to use lining figures for subsection
% labels.
\let\oldTableOfContents\tableofcontents
\renewcommand\tableofcontents{%
  {%
    \addfontfeature{Numbers={Lining,Monospaced}}%
    \oldTableOfContents%
  }%
}

% Use uppercase Roman numerals to number sections.
\renewcommand\thesection{\Roman{section}}

% Number subsections so that, for example, the second section of Article I is
% Section 1.2.
\renewcommand\thesubsection{\arabic{section}.\arabic{subsection}}
\newcommand*\subsectionLabel{\addfontfeature{Numbers={Lining,Monospaced}}\thesubsection}
% Put subsection labels in a 20 pt wide box.
\newlength\labelLength
\labelLength=20bp

% From Section 8.1 of “Standard Document Classes for LaTeX version 2e”
% <https://ctan.org/pkg/article>, a table of contents consists of uses of
% \contentsline commands. Since \contentsline{⟨name⟩} expands to \l@⟨name⟩ (for
% example, \contentsline{section} expands to \l@section), redefining \l@⟨name⟩
% commands will modify the format of a table of contents. Most \l@⟨name⟩
% commands can be defined using \@dottedtocline{⟨level⟩}{⟨indent⟩}{⟨numwidth⟩}:
%
%   ⟨level⟩ is the numbering level; \section is level 1, \subsection is level 2,
%   and so on.
%
%   ⟨indent⟩ is the width of the space between the left margin and left edge of
%   the line.
%
%   ⟨numwidth⟩ is the width of the label (for example III, 1.2) in the table-of-
%   contents line.
%
% For table-of-contents lines corresponding to \section commands, use no
% indentation, and use a label width equal to the width of “VIII” plus the space
% that will follow a subsection label.
\newlength\subsectionLabelLength
\settowidth\subsectionLabelLength{\subsectionLabel}
\newlength\sectionLabelLength
\setcounter{section}{8}
\settowidth\sectionLabelLength{\thesection}
\setcounter{section}{0}
\addtolength\sectionLabelLength{\dimexpr\labelLength-\subsectionLabelLength}
\renewcommand*\l@section{\@dottedtocline{1}{\z@}{\sectionLabelLength}}

% For table-of-contents lines corresponding to \subsection commands…
\renewcommand*\l@subsection{%
  % …eliminate vertical space above this “paragraph”…
  \vspace{-\parskip}%
  % …and use an indentation equal to the width of labels of level-1 table-of-
  % contents lines.
  \@dottedtocline{2}{\sectionLabelLength}{\labelLength}%
}

% Sections 3.1 and 3.2 of “The titlesec, titleps and titletoc Packages”
% <https://ctan.org/pkg/titlesec> define the \titleformat and \titlespacing
% commands.
\titleformat
  {\section}
  [display]
  {%
    % Eliminate the paragraph space between the label and title.
    \parskip\z@%
    % Center the label and title.
    \centering%
    % Set the label and title in small caps.
    \addfontfeature{Letters={SmallCaps,UppercaseSmallCaps}}%
  }
  {Article \thesection}
  % Don’t add vertical space between the label and title.
  {\z@}
  {}
\titlespacing*
  {\section}
  {\z@}      % Don’t change the left margin of the label and title.
  {\parskip} % Add a paragraph space before the label.
  {\z@}      % Don’t change the right margin of the label and title.

% Italicize subsection titles.
\newcommand*\titleStyle{\itshape}
% Append a period to subsection titles.
\newcommand*\titleSuffix{.}
\titleformat
  {\subsection}
  [runin]
  {\titleStyle}
  {\makebox[\labelLength][l]{\subsectionLabel}}
  {\z@}
  {}
  [\titleSuffix]
\titlespacing*
  {\subsection}
  {\z@}      % Don’t change the left margin of the label and title.
  {\z@}      % Don’t add space above the label and title.
  {\wordsep} % Add a word space after the title.

% Use a list for subsubsections.
\newenvironment{subsubsectionList}{%
  \begin{list}{\Alph{enumi}.}{%
    \topsep\z@%
    \partopsep\z@%
    \parsep\parskip%
    \itemsep\z@%
    \labelsep\z@%
    \labelwidth\labelLength%
    \leftmargin\labelwidth%
    \usecounter{enumi}%
  }%
}{\end{list}}

% Define a compact ordered list.
\newenvironment{orderedList}{%
\begin{list}{\arabic{enumii}.}{%
  \topsep\z@%
  \partopsep\z@%
  \parsep\parskip%
  \itemsep\z@%
  \labelsep\z@%
  \labelwidth\labelLength%
  \leftmargin\labelwidth%
  \usecounter{enumii}%
}%
}{\end{list}}

% Redefine \@mklab to put a list label on the left side of its box.
\def\@mklab#1{#1\hfil}

% Restore the catcode of @.
\makeatother

% Encapsulate references to the Constitution and Statutory Code as commands.
\newcommand*\ConstitutionReference[2]{Article~#1, Section~#2 of the \emph{Constitution}}
% The dash used in Statutory Code references is a non-breaking hyphen (U+2011).
\newcommand*\StatutoryCodeReference[2]{Code~#1‑#2}

% Use small caps for acronyms.
\newcommand*\acronym[1]{{\addfontfeature{Letters=UppercaseSmallCaps}#1}}

% Use a small, sans-serif font for margin notes.
\renewcommand*\marginfont{\sffamily\scriptsize}
% Allow hyphenation in margin notes.
\renewcommand*\raggedrightmarginnote{\RaggedRight}

\AtBeginDocument{
  \frenchspacing  % Don’t put extra space after a full stop.
  \urlstyle{same} % Don’t typeset URLs in a fixed-width font.
}
